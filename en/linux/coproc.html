<h1 id="coproc">coproc</h1>

<p>Bash builtin for creating interactive asynchronous subshells.
More information: <a href="https://www.gnu.org/software/bash/manual/bash.html#Coprocesses">https://www.gnu.org/software/bash/manual/bash.html#Coprocesses</a>.</p>

<ul>
  <li>Run a subshell asynchronously:</li>
</ul>

<p><code class="language-plaintext highlighter-rouge">coproc { </code><span class="tldr-var badge badge-pill bg-dark-lm bg-white-dm text-white-lm text-dark-dm font-weight-bold">command1; command2; …</span><code class="language-plaintext highlighter-rouge">; }</code></p>

<ul>
  <li>Create a coprocess with a specific name:</li>
</ul>

<p><code class="language-plaintext highlighter-rouge">coproc </code><span class="tldr-var badge badge-pill bg-dark-lm bg-white-dm text-white-lm text-dark-dm font-weight-bold">name</span><code class="language-plaintext highlighter-rouge"> { </code><span class="tldr-var badge badge-pill bg-dark-lm bg-white-dm text-white-lm text-dark-dm font-weight-bold">command1; command2; …</span><code class="language-plaintext highlighter-rouge">; }</code></p>

<ul>
  <li>Write to a specific coprocess <code class="language-plaintext highlighter-rouge">stdin</code>:</li>
</ul>

<p><code class="language-plaintext highlighter-rouge">echo "</code><span class="tldr-var badge badge-pill bg-dark-lm bg-white-dm text-white-lm text-dark-dm font-weight-bold">input</span><code class="language-plaintext highlighter-rouge">" &gt;&amp;"$</code><span class="tldr-var badge badge-pill bg-dark-lm bg-white-dm text-white-lm text-dark-dm font-weight-bold">{name</span><code class="language-plaintext highlighter-rouge">[1]}"</code></p>

<ul>
  <li>Read from a specific coprocess <code class="language-plaintext highlighter-rouge">stdout</code>:</li>
</ul>

<p><code class="language-plaintext highlighter-rouge">read </code><span class="tldr-var badge badge-pill bg-dark-lm bg-white-dm text-white-lm text-dark-dm font-weight-bold">variable</span><code class="language-plaintext highlighter-rouge"> &lt;&amp;"$</code><span class="tldr-var badge badge-pill bg-dark-lm bg-white-dm text-white-lm text-dark-dm font-weight-bold">{name</span><code class="language-plaintext highlighter-rouge">[0]}"</code></p>

<ul>
  <li>Create a coprocess which repeatedly reads <code class="language-plaintext highlighter-rouge">stdin</code> and runs some commands on the input:</li>
</ul>

<p><code class="language-plaintext highlighter-rouge">coproc </code><span class="tldr-var badge badge-pill bg-dark-lm bg-white-dm text-white-lm text-dark-dm font-weight-bold">name</span><code class="language-plaintext highlighter-rouge"> { while read line; do </code><span class="tldr-var badge badge-pill bg-dark-lm bg-white-dm text-white-lm text-dark-dm font-weight-bold">command1; command2; …</span><code class="language-plaintext highlighter-rouge">; done }</code></p>

<ul>
  <li>Create a coprocess which repeatedly reads <code class="language-plaintext highlighter-rouge">stdin</code>, runs a pipeline on the input, and writes the output to <code class="language-plaintext highlighter-rouge">stdout</code>:</li>
</ul>

<p><code class="language-plaintext highlighter-rouge">coproc </code><span class="tldr-var badge badge-pill bg-dark-lm bg-white-dm text-white-lm text-dark-dm font-weight-bold">name</span><code class="language-plaintext highlighter-rouge"> { while read line; do echo "$line" | </code><span class="tldr-var badge badge-pill bg-dark-lm bg-white-dm text-white-lm text-dark-dm font-weight-bold">command1 | command2 | …</span><code class="language-plaintext highlighter-rouge"> | cat /dev/fd/0; done }</code></p>

<ul>
  <li>Create and use a coprocess running <code class="language-plaintext highlighter-rouge">bc</code>:</li>
</ul>

<p><code class="language-plaintext highlighter-rouge">coproc BC { bc --mathlib; }; echo "1/3" &gt;&amp;"${BC[1]}"; read output &lt;&amp;"${BC[0]}"; echo "$output"</code></p>
